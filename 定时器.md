# 定时器概述

1. 软件定时器原理
   1. CPU等待，无法处理其他任务
2. 定时器定时原理
   1. 使用精准时基，通过硬件方式，实现功能
   2. 核心是计数器
3. STM32定时器分类
   1. 常规定时器
      1. 基本定时器
      2. 通用定时器
      3. 高级定时器
   2. 专用定时器
      1. 独立看门狗
      2. 窗口看门狗
      3. 实时时钟
      4. 低功耗定时器
   3. 内核定时器
      1. SysTick定时器
4. STM32定时器特性表
   1. 共8个定时器（都是16位）（整数预分频，1~65535）（可产生DMA请求）
      1. 基本定时器：6、7（递增）（无捕获/比较通道）（无互补输出）
      2. 通用定时器：2、3、4、5（递增、递减、中央对齐）（4个捕获/比较通道）（无互补输出）
      3. 高级定时器：1、8（递增、递减、中央对齐）（4个捕获/比较通道）（有互补输出）
5. STM32基本、通用、高级定时器功能区别
   1. 基本定时器：无输入输出通道，常用作时基。
   2. 通用定时器：具有多路独立通道，可用于输入捕获/输出比较，可用作时基。
   3. 高级定时器：除具备通用定时器所有功能外，具备带死区控制的互补信号输出、刹车输入功能。

# 基本定时器

1. 基本定时器简介
   1. TIM6 和 TIM7
   2. 16位 0~65535 递增计数器
   3. 16位预分频器 分频系数：1~65536
   4. 可用于触发DAC
   5. 更新事件（计数器溢出）时，可产生中断/DMA请求
2. 基本定时器框图
3. 定时器计数模式及溢出条件
   1. 递增 溢出条件 CNT == ARR(影子)
   2. 递减 溢出条件 CNT == 0
   3. 中心对齐 溢出条件 CNT == ARR-1 CNT == 1
4. 定时器中断实验相关寄存器
   1. 控制寄存器
      1. 位7：自动重装载预装载使能（有缓冲可以减小误差）
      2. 位0：计数器使能
   2. DMA中断使能寄存器
      1. 位8：更新DMA请求使能位（0禁止更新DMA请求，1允许更新DMA请求）
      2. 位0：更新中断使能（0禁止更新中断，1允许更新中断）
   3. 状态寄存器
      1. 位0：更新中断标志，更新中断时硬件置1，通过软件置0清除
   4. 计数寄存器CNT
      1. 共有16位，存储计数的值
   5. 预分频寄存器
      1. 16位，配置计数器时钟频率
      2. 计数器时钟频率=输入时钟频率 / (寄存器值+1)
   6. 自动重装载寄存器
      1. 16位，更新事件发生时，其值转移到对应影子寄存器中
5. 定时器溢出时间计算方法
   1. 溢出时间 = (自动重装载寄存器的值+1) * (预分频寄存器的值+1) / 定时器时钟源频率
6. 定时器中断实验配置步骤
   1. 配置定时器基础工作参数 HAL_TIM_Base_Init()
   2. 定时器基础MSP初始化 HAL_TIM_Base_MspInit()
   3. 使能更新中断，启动计数器 HAL_TIM_Base_Start_IT()
   4. 设置优先级，使能中断 HAL_NVIC_SetPriority() HAL_NVIC_EnableIRQ()
   5. 编写中断函数 TIMx_IRQHandler() HAL_TIM_IRQHandler()
   6. 编写定时器更新中断回调函数 HAL_TIM_PeriodElapsedCallback()
7. 编程实战：定时器中断实验

# 通用定时器

1. 通用定时器简介
   1. TIM2 TIM3 TIM4 TIM5
   2. 主要特性
      1. 16位、递增、递减、中心对齐计数器
      2. 16位预分频器
      3. 可用于触发DAC ADC
      4. 在更新时间、触发事件、输入捕获、输出比较时，产生中断、DMA请求
      5. 四个独立通道，可用于输入捕获、输出比较、输出PWM单脉冲
      6. 使用外部信号控制定时器、多定时器级联
      7. 支持编码器、霍尔传感器电路
2. 通用定时器框图
   1. 时钟源
      1. APB时钟源
      2. 内部触发输入
      3. 外部IO复用为定时器输入
      4. 通道1和通道2（外部引脚复用得来的）
   2. 控制器
      1. 触发信号通往其他定时器/DAC/ADC
      2. 模式控制器发出信号可用于：复位、使能、递增、计数
   3. 时基单元
      1. 预分频器
      2. 计数器
      3. 自动重装载寄存器
   4. 输入捕获
   5. 捕获比较
   6. 输出比较
      1. CNT计数器的值 与 影子寄存器比较 输出参考信号（中断）
3. 计数器时钟源
   1. 内部时钟(CK_INT)，来自外设总线APB提供的时钟
   2. 外部时钟模式1，来自外部输入引脚TIx，来自定时器通道1 或 通道2引脚
   3. 外部时钟模式2，外部触发输入引脚ETR
   4. 内部触发输入ITRx，用于芯片内部与其他通用/高级定时器级联
4. 通用定时器PWM输出实验
5. 通用定时器输入捕获实验
6. 通用定时器脉冲计数实验

# 高级定时器

# 总结