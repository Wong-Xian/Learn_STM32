# map 文件的组成

- 程序段交叉引用关系
- 删除映像未使用的程序段
- 映像符号表
- 映像内存分布图
- 映像组件大小

# STM32 启动过程

## 启动模式

内核复位后的事：
    1. 从地址0x0000 0000 处取出【堆栈指针MSP】的初始值，该值是栈顶地址。
    2. 从地址0x0000 0004 处取出【程序计数器指针PC】的初始值，该值是复位向量。

芯片厂商可以把 0x0000 0000 和 0x0000 0004 映射到其他地址，从而产生不同的启动模式。

### F1 启动模式

系统复位后，SYSCLK 的第四个上升沿，BOOT 引脚的值将被锁存。

## 启动过程

1. 内核复位，从0x0000 0000 （被映射到0x0800 0000）取MSP值，从 0x0000 0004 （被映射到0x0800 0004）取PC值。
2. 根据 PC 值跳转到复位中断函数（定义在启动文件 startup_stm32xxx.s 中）。
3. Reset_Handler 函数调用 main 函数。

## 启动文件介绍

1. 初始化 MSP
2. 初始化 PC
3. 设置堆栈大小
4. 初始化中断向量表
5. 调用初始化函数（可选）
6. 调用 __main 函数

## Reset_Handler 函数介绍

汇编语言编写。

``` asm
Reset_Handler PROC                  // 定义子程序
    EXPORT Reset_Handler [WEAK]     // 表明全局属性，弱定义，可被外部重新定义

    IMPORT __main                   // 声明来自外部文件
    IMPORT SystemInit               // 类似 extern

    LDR R0,=SystemInit              // 外部函数地址装载到R0
    BLX R0                          // 跳转到外部函数

    LDR R0,=__main                  // 外部函数地址装载到R0
    BX R0                           // 跳转到外部函数

    ENDP                            // 子程序结束
```